<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Typing Test</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f0f0f;
  color: #eaeaea;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.container {
  width: 900px;
  max-width: 95%;
}

.top {
  display: flex;
  justify-content: space-between;
  margin-bottom: 14px;
}

select, button {
  background: #222;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 6px;
  cursor: pointer;
}

#text {
  background: #181818;
  padding: 22px;
  border-radius: 12px;
  font-size: 22px;
  line-height: 1.7;
  min-height: 140px;
  user-select: none;
}

#text.error {
  box-shadow: 0 0 10px #f44336;
}

.correct {
  color: #4caf50;
  animation: pop 0.15s ease;
}

.incorrect {
  color: #f44336;
}

.current {
  border-bottom: 2px solid #9c27b0;
  animation: blink 1s infinite;
}

@keyframes blink {
  50% { border-color: transparent; }
}

@keyframes pop {
  50% { transform: scale(1.15); }
}

input {
  opacity: 0;
  position: absolute;
}
</style>
</head>

<body>
<div class="container">
  <div class="top">
    <div>
      WPM: <b id="wpm">0</b>
      &nbsp; Accuracy: <b id="acc">100</b>%
      &nbsp; Time: <b id="time">60</b>s
    </div>

    <div>
      <select id="timeSelect">
        <option value="15">15s</option>
        <option value="30">30s</option>
        <option value="60" selected>60s</option>
        <option value="120">120s</option>
        <option value="9999">∞</option>
      </select>
      <button onclick="resetTest()">Restart</button>
    </div>
  </div>

  <div id="text"></div>
  <input id="input" autofocus>
</div>

<audio id="keySound" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA="></audio>
<audio id="errorSound" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA="></audio>

<script>
const words = [
  "that","what","when","why","how","how","mine","there","their","here",
  "for","and","an","a","have","bye","buy","by","build","book",
  "fox","box","blob","animation","quick","lazy","the"
];

const textEl = document.getElementById("text");
const input = document.getElementById("input");
const wpmEl = document.getElementById("wpm");
const accEl = document.getElementById("acc");
const timeEl = document.getElementById("time");
const timeSelect = document.getElementById("timeSelect");

const keySound = document.getElementById("keySound");
const errorSound = document.getElementById("errorSound");

let index, correct, typed, errorStreak, locked;
let time, initialTime, timer;

function generateText() {
  textEl.innerHTML = "";
  index = correct = typed = errorStreak = 0;
  locked = false;

  const text = Array.from({ length: 50 }, () =>
    words[Math.floor(Math.random() * words.length)]
  ).join(" ");

  [...text].forEach((c, i) => {
    const span = document.createElement("span");
    span.textContent = c;
    if (i === 0) span.classList.add("current");
    textEl.appendChild(span);
  });
}

function startTimer() {
  if (timer || time === 9999) return;
  timer = setInterval(() => {
    time--;
    timeEl.textContent = time;
    if (time <= 0) endTest();
  }, 1000);
}

function endTest() {
  clearInterval(timer);
  input.disabled = true;
}

input.addEventListener("keydown", e => {
  if (e.key.length !== 1) return;
  startTimer();

  const chars = textEl.querySelectorAll("span");
  const current = chars[index];
  if (!current) return;

  typed++;

  if (locked && e.key !== current.textContent) {
    errorSound.currentTime = 0;
    errorSound.play();
    textEl.classList.add("error");
    e.preventDefault();
    return;
  }

  if (e.key === current.textContent) {
    current.classList.add("correct");
    keySound.currentTime = 0;
    keySound.play();
    correct++;
    errorStreak = 0;
    locked = false;
    textEl.classList.remove("error");
    moveForward();
  } else {
    current.classList.add("incorrect");
    errorSound.currentTime = 0;
    errorSound.play();
    errorStreak++;
    if (errorStreak >= 2) locked = true;
  }

  updateStats();
  e.preventDefault();
});

function moveForward() {
  const chars = textEl.querySelectorAll("span");
  chars[index].classList.remove("current");
  index++;
  if (chars[index]) chars[index].classList.add("current");
}

function updateStats() {
  const elapsed = Math.max(1, initialTime - time);
  wpmEl.textContent = Math.round((correct / 5) / (elapsed / 60));
  accEl.textContent = Math.round((correct / typed) * 100) || 100;
}

function resetTest() {
  clearInterval(timer);
  timer = null;
  initialTime = parseInt(timeSelect.value);
  time = initialTime;
  timeEl.textContent = time === 9999 ? "∞" : time;
  input.disabled = false;
  wpmEl.textContent = 0;
  accEl.textContent = 100;
  generateText();
}

resetTest();
</script>
</body>
</html>
