<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Typing Test Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root {
  --bg: #0f0f0f;
  --panel: #181818;
  --text: #eaeaea;
  --good: #4caf50;
  --bad: #f44336;
  --accent: #9c27b0;
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  font-family: Arial, Helvetica, sans-serif;
  background: var(--bg);
  color: var(--text);
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.container {
  width: 900px;
  max-width: 95%;
}

.top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.stats span {
  margin-right: 20px;
}

select, button {
  background: #222;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 6px;
  cursor: pointer;
}

#text {
  background: var(--panel);
  padding: 24px;
  border-radius: 12px;
  font-size: 22px;
  line-height: 1.7;
  user-select: none;
  min-height: 140px;
  transition: box-shadow 0.2s;
}

#text.error {
  box-shadow: 0 0 12px var(--bad);
}

.correct {
  color: var(--good);
  animation: pop 0.15s ease;
}

.incorrect {
  color: var(--bad);
}

.current {
  border-bottom: 2px solid var(--accent);
  animation: blink 1s infinite;
}

@keyframes blink {
  50% { border-color: transparent; }
}

@keyframes pop {
  0% { transform: scale(1); }
  50% { transform: scale(1.15); }
  100% { transform: scale(1); }
}

input {
  opacity: 0;
  position: absolute;
}
</style>
</head>

<body>
<div class="container">
  <div class="top">
    <div class="stats">
      <span>WPM: <b id="wpm">0</b></span>
      <span>Accuracy: <b id="acc">100</b>%</span>
      <span>Time: <b id="time">60</b>s</span>
    </div>

    <div>
      <select id="timeSelect">
        <option value="15">15s</option>
        <option value="30">30s</option>
        <option value="60" selected>60s</option>
        <option value="120">120s</option>
        <option value="9999">∞</option>
      </select>
      <button onclick="resetTest()">Restart</button>
    </div>
  </div>

  <div id="text"></div>
  <input id="input" autofocus>
</div>

<audio id="keySound" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA="></audio>
<audio id="errorSound" src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA="></audio>

<script>
const words = [
  "typing","speed","accuracy","keyboard","javascript","github",
  "practice","developer","function","variable","interface",
  "animation","performance","design","logic","syntax"
];

const textEl = document.getElementById("text");
const input = document.getElementById("input");
const wpmEl = document.getElementById("wpm");
const accEl = document.getElementById("acc");
const timeEl = document.getElementById("time");
const timeSelect = document.getElementById("timeSelect");

const keySound = document.getElementById("keySound");
const errorSound = document.getElementById("errorSound");

let time;
let timer = null;
let index = 0;
let correct = 0;
let typed = 0;
let errorStreak = 0;
let locked = false;

function generateText() {
  textEl.innerHTML = "";
  index = correct = typed = errorStreak = 0;
  locked = false;

  const text = Array.from({ length: 45 },
    () => words[Math.floor(Math.random() * words.length)]
  ).join(" ");

  [...text].forEach((c, i) => {
    const span = document.createElement("span");
    span.textContent = c;
    if (i === 0) span.classList.add("current");
    textEl.appendChild(span);
  });
}

function startTimer() {
  if (timer || time === 9999) return;
  timer = setInterval(() => {
    time--;
    timeEl.textContent = time;
    if (time <= 0) endTest();
  }, 1000);
}

function endTest() {
  clearInterval(timer);
  input.disabled = true;
}

input.addEventListener("keydown", e => {
  if (e.key.length !== 1) return;
  startTimer();

  const chars = textEl.querySelectorAll("span");
  const current = chars[index];
  if (!current) return;

  typed++;

  if (locked && e.key !== current.textContent) {
    errorSound.currentTime = 0;
    errorSound.play();
    textEl.classList.add("error");
    e.preventDefault();
    return;
  }

  if (e.key === current.textContent) {
    current.classList.add("correct");
    keySound.currentTime = 0;
    keySound.play();
    correct++;
    errorStreak = 0;
    locked = false;
    textEl.classList.remove("error");
    moveForward();
  } else {
    current.classList.add("incorrect");
    errorSound.currentTime = 0;
    errorSound.play();
    errorStreak++;
    if (errorStreak >= 2) locked = true;
  }

  updateStats();
  e.preventDefault();
});

function moveForward() {
  const chars = textEl.querySelectorAll("span");
  chars[index].classList.remove("current");
  index++;
  if (chars[index]) chars[index].classList.add("current");
}

function updateStats() {
  const elapsed = Math.max(1, (initialTime - time));
  const wpm = Math.round((correct / 5) / (elapsed / 60));
  const acc = Math.round((correct / typed) * 100);
  wpmEl.textContent = wpm;
  accEl.textContent = acc || 100;
}

let initialTime = 60;

function resetTest() {
  clearInterval(timer);
  timer = null;
  initialTime = parseInt(timeSelect.value);
  time = initialTime;
  timeEl.textContent = time === 9999 ? "∞" : time;
  input.disabled = false;
  wpmEl.textContent = 0;
  accEl.textContent = 100;
  generateText();
}

resetTest();
</script>
</body>
</html>
